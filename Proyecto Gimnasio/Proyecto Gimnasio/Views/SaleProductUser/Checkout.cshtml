@using Proyecto_Gimnasio.Controllers
@model IEnumerable<Proyecto_Gimnasio.Models.Product>
@{
    var cartItems = ViewBag.CartItems as List<SaleProductUserController.CartItem>;
    var person = ViewBag.Person as Proyecto_Gimnasio.Models.Person;
}

<h2 class="mb-4">Confirmar Compra</h2>

<div class="alert alert-info p-3 mb-4 rounded">
    <strong>Cliente:</strong> @person.Name @person.LasName<br />
    <small class="text-muted">DNI: @person.Cnit</small>
</div>

<table class="table table-striped table-bordered">
    <thead class="table-primary">
        <tr>
            <th>Producto</th>
            <th>Cantidad</th>
            <th>Precio Unitario</th>
            <th>Subtotal</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in cartItems)
        {
            var p = Model.FirstOrDefault(x => x.IdProduct == item.ProductId);
            if (p != null)
            {
                <tr>
                    <td><strong>@p.NameProduct</strong></td>
                    <td class="text-center fw-bold">@item.Quantity</td>
                    <td>Bs @p.Price:</td>
                    <td class="text-end fw-bold">Bs @(p.Price* item.Quantity)</td>
                </tr>
            }
        }
    </tbody>
    <tfoot>
        <tr class="table-success fw-bold fs-3">
            <td colspan="3" class="text-end">TOTAL A PAGAR:</td>
            <td class="text-end">
                Bs @cartItems.Sum(i => Model.First(p => p.IdProduct == i.ProductId).Price * i.Quantity)
            </td>
        </tr>
    </tfoot>
</table>

<div class="text-center mt-5">
    <form asp-action="CheckoutConfirm" method="post">
        @Html.AntiForgeryToken()
        <button type="submit" class="btn btn-success btn-lg px-5">
            Confirmar y Finalizar Compra
        </button>
    </form>
    <a asp-action="Cart" class="btn btn-secondary btn-lg d-block mt-3">
        Volver al carrito
    </a>
</div>